# Inherited from original media deployment
persistentVolumeClaims:
  radarr-config:
    requestStorage: '10Gi'
    storageClassName: 'nfs'

# Disable config.xml mounting - let app manage its own config
application:
  config: null

ingress:
  enabled: true
  className: nginx
  host: radarr.asandov.local
  path: /
  pathType: Prefix
  annotations:
    external-dns.alpha.kubernetes.io/cloudflare-proxied: "true"

# Configure deployment with volumes and API key sync sidecar
deployment:
  serviceAccountName: media-apps
  # Configure volumes to use shared PVCs
  volumes:
    config:
      persistentVolumeClaim:
        claimName: 'radarr-config'
    downloads:
      persistentVolumeClaim:
        claimName: 'media-downloads'
    movies:
      persistentVolumeClaim:
        claimName: 'media-library'
  # Override volumeMounts to change /film to /movies
  container:
    volumeMounts:
      - name: 'config'
        mountPath: '/config'
      - name: 'downloads'
        mountPath: '/downloads'
      - name: 'movies'
        mountPath: '/movies'
  additionalContainers:
  - name: api-key-sync
    image: alpine/k8s:1.28.3
    command: ["/bin/sh"]
    args: ["/scripts/sync-api-key.sh"]
    env:
    - name: SERVICE_NAME
      value: "radarr"
    - name: SECRET_KEY
      value: "radarr-api-key"
    - name: CONFIG_PATH
      value: "/config/config.xml"
    volumeMounts:
    - name: config
      mountPath: /config
    - name: api-sync-script
      mountPath: /scripts
      readOnly: true
    resources:
      requests:
        memory: "32Mi"
        cpu: "10m"
      limits:
        memory: "64Mi"
        cpu: "50m"
  additionalVolumes:
  - name: api-sync-script
    configMap:
      name: api-key-sync-sidecar
      defaultMode: 0755