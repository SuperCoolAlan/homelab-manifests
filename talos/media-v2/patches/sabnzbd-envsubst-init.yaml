- op: replace
  path: /spec/template/spec/initContainers/0/args/1
  value: |
    #!/bin/sh
    # Copy config template
    cp /config-map/sabnzbd.ini /config-processed/sabnzbd.ini

    # Escape special characters in passwords for sed
    EWEKA_ESC=$(printf '%s\n' "$ewekaPassword" | sed 's/[&/\]/\\&/g')
    NEWSHOSTING_ESC=$(printf '%s\n' "$newshostingPassword" | sed 's/[&/\]/\\&/g')

    # Substitute passwords using sed with escaped values
    sed -i "s/\$ewekaPassword/$EWEKA_ESC/g" /config-processed/sabnzbd.ini
    sed -i "s/\$newshostingPassword/$NEWSHOSTING_ESC/g" /config-processed/sabnzbd.ini
- op: add
  path: /spec/template/spec/initContainers/0/env
  value:
    - name: ewekaPassword
      valueFrom:
        secretKeyRef:
          name: sabnzbd-passwords
          key: ewekaPassword
    - name: newshostingPassword
      valueFrom:
        secretKeyRef:
          name: sabnzbd-passwords
          key: newshostingPassword
