- op: replace
  path: /spec/template/spec/initContainers/0/args/1
  value: |
    #!/bin/sh
    # Copy config template
    cp /config-map/sabnzbd.ini /config-processed/sabnzbd.ini

    # Use printf to avoid shell interpretation of special characters
    # Escape special characters for sed (& / \)
    EWEKA_ESC=$(printf '%s' "$ewekaPassword" | sed -e 's/[&/\]/\\&/g')
    NEWSHOSTING_ESC=$(printf '%s' "$newshostingPassword" | sed -e 's/[&/\]/\\&/g')

    # Substitute passwords using sed with escaped values
    sed -i "s|\$ewekaPassword|$EWEKA_ESC|g" /config-processed/sabnzbd.ini
    sed -i "s|\$newshostingPassword|$NEWSHOSTING_ESC|g" /config-processed/sabnzbd.ini

    echo "Password substitution completed"
- op: add
  path: /spec/template/spec/initContainers/0/env
  value:
    - name: ewekaPassword
      valueFrom:
        secretKeyRef:
          name: sabnzbd-passwords
          key: ewekaPassword
    - name: newshostingPassword
      valueFrom:
        secretKeyRef:
          name: sabnzbd-passwords
          key: newshostingPassword
