apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: media-v2

resources:
- shared-pvcs.yaml
- resources/external-truenas-svc.yaml
- resources/jellyfin-ingress.yaml
- configs/setup-rbac.yaml
- configs/api-key-sync-sidecar.yaml
- configs/api-key-sync-rbac.yaml
# Applied separately via: sops -d windscribe-openvpn-creds.enc.yaml | kubectl apply -f -
#- windscribe-openvpn-creds.enc.yaml
- windscribe-openvpn-configmap.yaml
# Disabled - config jobs suck and don't work
#- configs/prowlarr-complete-setup-job.yaml
#- configs/radarr-full-config-job.yaml
#- configs/sonarr-full-config-job.yaml
#- configs/bazarr-setup-job.yaml
#- configs/jellyseerr-setup-job.yaml
#- configs/jellyseerr-config-job.yaml
#- configs/download-client-setup-job.yaml

# generators:
# - secrets-generator.yaml
# Secrets applied manually

# VPN sidecar for SABnzbd and password substitution
patches:
- target:
    kind: Deployment
    name: sabnzbd
  path: patches/add-gluetun-to-sabnzbd.yaml
- target:
    kind: Deployment
    name: sabnzbd
  path: patches/sabnzbd-envsubst-init.yaml

# API sync sidecars - DISABLED
#patches_disabled:

helmCharts:
- name: sonarr
  repo: https://media-servarr.shw.al/charts
  version: 0.8.4
  releaseName: sonarr
  namespace: media-v2
  valuesFile: values-overrides/sonarr-values.yaml
    
- name: radarr
  repo: https://media-servarr.shw.al/charts
  version: 0.18.0
  releaseName: radarr
  namespace: media-v2
  valuesFile: values-overrides/radarr-values.yaml

- name: prowlarr
  repo: https://media-servarr.shw.al/charts
  version: 0.16.0
  releaseName: prowlarr
  namespace: media-v2
  valuesFile: values-overrides/prowlarr-values.yaml

- name: sabnzbd
  repo: https://media-servarr.shw.al/charts
  version: 0.6.5
  releaseName: sabnzbd
  namespace: media-v2
  valuesFile: values-overrides/sabnzbd-values.yaml

- name: bazarr
  repo: https://media-servarr.shw.al/charts
  version: 0.8.3
  releaseName: bazarr
  namespace: media-v2
  valuesFile: values-overrides/bazarr-values.yaml

- name: jellyseerr
  repo: https://media-servarr.shw.al/charts
  version: 0.5.0
  releaseName: jellyseerr
  namespace: media-v2
  valuesFile: values-overrides/jellyseerr-values.yaml
