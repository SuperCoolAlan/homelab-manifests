apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: media-v2

resources:
- shared-pvcs.yaml
- resources/external-truenas-svc.yaml
- resources/jellyfin-ingress.yaml
- configs/setup-rbac.yaml
- configs/api-key-sync-sidecar.yaml
- configs/api-key-sync-rbac.yaml
- configs/prowlarr-complete-setup-job.yaml
- configs/radarr-full-config-job.yaml
- configs/sonarr-full-config-job.yaml
- configs/bazarr-setup-job.yaml
- configs/jellyseerr-setup-job.yaml
- configs/jellyseerr-config-job.yaml

generators:
- secrets-generator.yaml

patches:
- target:
    kind: Deployment
    name: sabnzbd
  path: patches/add-vpn-sidecars.yaml

# Sidecars are now added via helm values, not patches
#patchesStrategicMerge:
#- patches/add-api-sync-sidecars.yaml

helmCharts:
- name: sonarr
  repo: https://media-servarr.shw.al/charts
  version: 0.8.4
  releaseName: sonarr
  namespace: media-v2
  valuesFile: values-overrides/sonarr-values.yaml
    
- name: radarr
  repo: https://media-servarr.shw.al/charts
  version: 0.18.0
  releaseName: radarr
  namespace: media-v2
  valuesFile: values-overrides/radarr-values.yaml

- name: prowlarr
  repo: https://media-servarr.shw.al/charts
  version: 0.16.0
  releaseName: prowlarr
  namespace: media-v2
  valuesFile: values-overrides/prowlarr-values.yaml

- name: sabnzbd
  repo: https://media-servarr.shw.al/charts
  version: 0.6.5
  releaseName: sabnzbd
  namespace: media-v2
  valuesFile: values-overrides/sabnzbd-values.yaml

- name: bazarr
  repo: https://media-servarr.shw.al/charts
  version: 0.8.3
  releaseName: bazarr
  namespace: media-v2
  valuesFile: values-overrides/bazarr-values.yaml

- name: homarr
  repo: https://media-servarr.shw.al/charts
  version: 0.16.0
  releaseName: homarr
  namespace: media-v2
  valuesFile: values-overrides/homarr-values.yaml

- name: jellyseerr
  repo: https://media-servarr.shw.al/charts
  version: 0.5.0
  releaseName: jellyseerr
  namespace: media-v2
  valuesFile: values-overrides/jellyseerr-values.yaml
